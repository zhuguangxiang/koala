#
# MIT License
# Copyright (c) 2018 James, https://github.com/zhuguangxiang
#

INCLUDE(${PROJECT_SOURCE_DIR}/cmake/llvm.cmake)

SET(JIT_SOURCES
  jit_llvm.c jit.c)

SET(JIT_VERSION 0.1.0)
SET(JIT_VERSION_SO 0)

SET(BACKUP_PREFIX ${CMAKE_SHARED_LIBRARY_PREFIX})
SET(CMAKE_SHARED_LIBRARY_PREFIX)

ADD_LIBRARY(jit_so SHARED ${JIT_SOURCES})
TARGET_LINK_LIBRARIES(jit_so ${llvm_libs})
SET_TARGET_PROPERTIES(jit_so PROPERTIES
  VERSION ${JIT_VERSION}
  SOVERSION ${JIT_VERSION_SO}
  OUTPUT_NAME jit)

#INSTALL(TARGETS jit_so DESTINATION koala-${KOALA_VERSION_MAIN}/pkgs)

SET(CMAKE_SHARED_LIBRARY_PREFIX ${BACKUP_PREFIX})